<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>timing.js - TimingManager</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="TimingManager"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/TimingManager.html">TimingManager</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: timing.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * Consumes timing information and runs handlers bound to animation
 * labels.
 *
 * @author Simon Potter
 * @licence GPL-2
 * @class TimingManager
 * @constructor
 * @param {Array|Object} timingInfo Timing information, as
 * exported by the [animaker package](https:&#x2F;&#x2F;github.com&#x2F;pmur002&#x2F;animaker) in [R](http:&#x2F;&#x2F;www.r-project.org&#x2F;). For more information, refer to &#x60;?export&#x60; in R once animaker has loaded.
 * @param {String} [timeUnit=&quot;ms&quot;] Determine what time units the
 * timing information exported from animaker refers to. Must be one of
 * &#x60;&quot;ms&quot;&#x60; (milliseconds), &#x60;&quot;s&quot;&#x60; (seconds), or &#x60;&quot;m&quot;&#x60; (minutes).
 *&#x2F;
var TimingManager = function(timingInfo, timeUnit) {
    &#x2F;&#x2F; If we&#x27;ve just exported a single animation, force it
    &#x2F;&#x2F; to be an array to generalise the rest of the code to arrays.
    if (! _.isArray(timingInfo))
        timingInfo = [timingInfo];

    &#x2F;&#x2F; Assume milliseconds by default, as that&#x27;s natural in JS
    timeUnit = timeUnit || &quot;ms&quot;;
    if (! (_.isString(timeUnit) &amp;&amp;
           _.contains([&quot;ms&quot;, &quot;s&quot;, &quot;m&quot;], timeUnit)))
        throw new Error(&quot;Invalid &#x27;timeUnit&#x27;: Must be one of &#x27;ms&#x27;, &#x27;s&#x27;, &#x27;m&#x27;&quot;);

    &#x2F;&#x2F; Where all our animation actions will be stored
    var callbacks = {};

    &#x2F;&#x2F; Converts a unit of time to milliseconds
    var toMs = function(t) {
        if (timeUnit === &quot;ms&quot;)
            return t;
        if (timeUnit === &quot;s&quot;)
            return t * 1000;
        if (timeUnit === &quot;m&quot;)
            return t * 60 * 1000;
        throw new Error(&quot;Invalid &#x27;timeUnit&#x27;: &quot; + timeUnit);
    };

    &#x2F;**
     * Registers an action to an animation
     * @param {Object} fns An object where the keys are the labels for an animation, and the values are a function to register as an action to that animation
     * @param {Boolean} [overwrite=false] Allows us to overwrite existing actions for animations.
     *&#x2F;
    this.register = function(fns, overwrite) {
        for (var f in fns) {
            if (! callbacks[f] || overwrite)
                callbacks[f] = fns[f];
        }
    };

    &#x2F;&#x2F; Checks whether we have any actions associated with animations
    var ensureNonEmpty = function() {
        if (_.isEmpty(callbacks))
            throw new Error(&quot;No actions assigned to animations, see &#x27;register()&#x27;&quot;);
    };

    &#x2F;**
     * Plays all animations associated with actions
     *
     * @method play
     * @param {Number} [t=0] An optional delay (in &#x60;timeUnit&#x60;s) to add to the entire animation.
     *&#x2F;
    this.play = function(t) {
        ensureNonEmpty();
        t = t || 0; &#x2F;&#x2F; Default to 0 ms
        _.each(timingInfo, function(anim) {
            if (callbacks[anim.label]) {
                _.delay(callbacks[anim.label],
                        t + toMs(anim.start),
                        anim);
            } else {
                console.warn(&quot;Ignoring playback of animation: &quot; + anim.label);
            }
        });
    };

    &#x2F;**
     * Returns all of the timing information about the frames that are to be played at a given time.
     *
     * @method frameTiming
     * @param {Number} [t=0] The time in *milliseconds* to select an animation from
     * @return {Array} A list of matching animations to play at the current time
     *&#x2F;
    this.frameTiming = function(t) {
        t = t || 0; &#x2F;&#x2F; Default to 0
        return _.filter(timingInfo, function(info) {
            return (t &gt;= toMs(info.start)) &amp;&amp;
                    (t &lt; toMs(info.start + info.durn));
        });
    };

    &#x2F;**
     * Plays all animations associated with actions at a given rate per second.
     *
     * @method frameApply
     * @param {Number} [fps=10] How many frames per second are going to be drawn. By default this is 10.
     * @param {Number} [t=0] An optional delay (in &#x60;timeUnit&#x60;s) to add to the entire animation
     *&#x2F;
    this.frameApply = function(fps, t) {
        ensureNonEmpty();
        t = t || 0;
        t = toMs(t);
        fps = fps || 10;
        if (fps &lt;= 0)
            throw new Error(&quot;Frames per second must be &gt; 0&quot;);
        var increment = 1000 &#x2F; fps;
        var durn = 0;
        _.each(timingInfo, function(info) {
            durn = Math.max(durn, toMs(info.start + info.durn));
        });
        var times = [];
        var i;
        for (i = 0; (i * increment) &lt; durn; i++) {
            times.push(t + (i * increment));
        }

        &#x2F;&#x2F; Do the playback after a delay in ms
        var playFrame = function(anim, t) {
            if (callbacks[anim.label]) {
                _.delay(callbacks[anim.label], t, anim);
            } else {
                console.warn(&quot;Ignoring playback of animation: &quot; + anim.label);
            }
        };

        &#x2F;&#x2F; A convenience generator function for playing back timing information
        var singleTiming = function(t) {
            return function(info) {
                playFrame(info, t);
            };
        };

        &#x2F;&#x2F; Play each frame
        for (i = t; i &lt; _.last(times); i += increment) {
            var currentTiming = this.frameTiming(i);
            if (currentTiming) {
                _.each(currentTiming, singleTiming(i));
            }
        }
    };
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
